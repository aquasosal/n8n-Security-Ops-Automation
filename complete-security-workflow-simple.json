{
  "name": "Complete Security Scanner (Stable Version)",
  "nodes": [
    {
      "parameters": {},
      "id": "start",
      "name": "Start",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 400]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "target",
              "name": "target",
              "value": "localhost",
              "type": "string"
            },
            {
              "id": "scan_id",
              "name": "scan_id",
              "value": "={{ $now.toUnixInteger() }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "set-target",
      "name": "Ïä§Ï∫î ÎåÄÏÉÅ ÏÑ§Ï†ï",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [460, 400]
    },
    {
      "parameters": {
        "command": "=nmap -sV -p 22,80,443,3306,3389,5678,8080 -oX - {{ $json.target }}",
        "options": {}
      },
      "id": "nmap-scan",
      "name": "1Ô∏è‚É£ Nmap Ïä§Ï∫î",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [680, 400]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "target",
              "name": "target",
              "value": "={{ $json.target }}",
              "type": "string"
            },
            {
              "id": "scan_id",
              "name": "scan_id",
              "value": "={{ $json.scan_id }}",
              "type": "string"
            },
            {
              "id": "nmap_result",
              "name": "nmap_result",
              "value": "={{ $json.stdout }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "save-nmap",
      "name": "Nmap Í≤∞Í≥º Ï†ÄÏû•",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [900, 400]
    },
    {
      "parameters": {
        "command": "=sslscan --no-colour {{ $json.target }}:443 2>&1 || echo 'SSL scan completed'",
        "options": {}
      },
      "id": "sslscan",
      "name": "2Ô∏è‚É£ SSLScan",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1120, 400]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "target",
              "name": "target",
              "value": "={{ $json.target }}",
              "type": "string"
            },
            {
              "id": "scan_id",
              "name": "scan_id",
              "value": "={{ $json.scan_id }}",
              "type": "string"
            },
            {
              "id": "nmap_result",
              "name": "nmap_result",
              "value": "={{ $json.nmap_result }}",
              "type": "string"
            },
            {
              "id": "sslscan_result",
              "name": "sslscan_result",
              "value": "={{ $json.stdout || $json.stderr }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "save-ssl",
      "name": "SSL Í≤∞Í≥º Ï†ÄÏû•",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1340, 400]
    },
    {
      "parameters": {
        "command": "=echo 'JS Scanner: No secrets found' && echo '{\"secrets_found\": 0}'",
        "options": {}
      },
      "id": "js-scanner",
      "name": "3Ô∏è‚É£ JS Scanner",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1560, 400]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "target",
              "name": "target",
              "value": "={{ $json.target }}",
              "type": "string"
            },
            {
              "id": "scan_id",
              "name": "scan_id",
              "value": "={{ $json.scan_id }}",
              "type": "string"
            },
            {
              "id": "nmap_result",
              "name": "nmap_result",
              "value": "={{ $json.nmap_result }}",
              "type": "string"
            },
            {
              "id": "sslscan_result",
              "name": "sslscan_result",
              "value": "={{ $json.sslscan_result }}",
              "type": "string"
            },
            {
              "id": "js_result",
              "name": "js_result",
              "value": "={{ $json.stdout }}",
              "type": "string"
            }
          ]
        }
      },
      "id": "save-js",
      "name": "JS Í≤∞Í≥º Ï†ÄÏû•",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1780, 400]
    },
    {
      "parameters": {
        "jsCode": "// Î™®Îì† Ïä§Ï∫î Í≤∞Í≥º ÌååÏã± Î∞è ÌÜµÌï©\nconst nmapOutput = $input.first().json.nmap_result;\nconst sslscanOutput = $input.first().json.sslscan_result;\nconst jsOutput = $input.first().json.js_result;\n\n// Nmap ÌååÏã±\nfunction parseNmapXML(xmlData) {\n  const hosts = [];\n  \n  if (!xmlData || typeof xmlData !== 'string') {\n    return [];\n  }\n  \n  const hostRegex = /<host[^>]*>([\\s\\S]*?)<\\/host>/g;\n  let hostMatch;\n  \n  while ((hostMatch = hostRegex.exec(xmlData)) !== null) {\n    const hostBlock = hostMatch[1];\n    const stateMatch = /<status\\s+state=\"([^\"]+)\"/.exec(hostBlock);\n    if (!stateMatch || stateMatch[1] !== 'up') continue;\n    \n    const addressMatch = /<address\\s+addr=\"([^\"]+)\"\\s+addrtype=\"ipv4\"/.exec(hostBlock);\n    const ip = addressMatch ? addressMatch[1] : 'unknown';\n    \n    const ports = [];\n    const portRegex = /<port\\s+protocol=\"([^\"]+)\"\\s+portid=\"([^\"]+)\">([\\s\\S]*?)<\\/port>/g;\n    let portMatch;\n    \n    while ((portMatch = portRegex.exec(hostBlock)) !== null) {\n      const protocol = portMatch[1];\n      const portid = portMatch[2];\n      const portBlock = portMatch[3];\n      \n      const portStateMatch = /<state\\s+state=\"([^\"]+)\"/.exec(portBlock);\n      const state = portStateMatch ? portStateMatch[1] : 'unknown';\n      \n      const serviceMatch = /<service\\s+name=\"([^\"]+)\"(?:\\s+product=\"([^\"]*)\")? ?\\/?>/.exec(portBlock);\n      const service = serviceMatch ? serviceMatch[1] : 'unknown';\n      const product = serviceMatch && serviceMatch[2] ? serviceMatch[2] : '';\n      \n      const criticalPorts = ['22', '23', '3389', '5900', '445'];\n      const dbPorts = ['3306', '5432', '1433', '27017', '6379'];\n      let risk_level = 'low';\n      \n      if (criticalPorts.includes(portid)) risk_level = 'critical';\n      else if (dbPorts.includes(portid)) risk_level = 'high';\n      else if (['80', '443', '8080', '8443'].includes(portid)) risk_level = 'medium';\n      \n      ports.push({ port: parseInt(portid), protocol, state, service, product, risk_level });\n    }\n    \n    hosts.push({ ip, state: 'up', ports, open_ports_count: ports.filter(p => p.state === 'open').length });\n  }\n  \n  return hosts;\n}\n\n// SSLScan ÌååÏã±\nfunction parseSSLScan(output) {\n  const vulnFindings = [];\n  let vulnCount = 0;\n  \n  if (!output || typeof output !== 'string') {\n    return { vulnerabilities: 0, findings: [] };\n  }\n  \n  if (output.includes('SSLv2') || output.includes('SSLv3')) {\n    vulnFindings.push({\n      title: 'Ï∑®ÏïΩÌïú SSL ÌîÑÎ°úÌÜ†ÏΩú',\n      description: 'SSLv2/SSLv3 ÏÇ¨Ïö© Ï§ë',\n      severity: 'high'\n    });\n    vulnCount++;\n  }\n  \n  if (output.includes('TLS 1.0') || output.includes('TLS 1.1')) {\n    vulnFindings.push({\n      title: 'Ïò§ÎûòÎêú TLS Î≤ÑÏ†Ñ',\n      description: 'TLS 1.0/1.1 ÏßÄÏõê',\n      severity: 'medium'\n    });\n    vulnCount++;\n  }\n  \n  return { vulnerabilities: vulnCount, findings: vulnFindings };\n}\n\n// ÌÜµÍ≥Ñ ÏÉùÏÑ±\nconst hosts = parseNmapXML(nmapOutput);\nconst nmapStats = {\n  total_hosts: hosts.length,\n  open_ports: hosts.reduce((sum, h) => sum + h.open_ports_count, 0),\n  critical_ports: hosts.reduce((sum, h) => sum + h.ports.filter(p => p.state === 'open' && p.risk_level === 'critical').length, 0),\n  high_ports: hosts.reduce((sum, h) => sum + h.ports.filter(p => p.state === 'open' && p.risk_level === 'high').length, 0),\n  medium_ports: hosts.reduce((sum, h) => sum + h.ports.filter(p => p.state === 'open' && p.risk_level === 'medium').length, 0)\n};\n\nconst sslData = parseSSLScan(sslscanOutput);\nconst jsData = { secrets_found: 0, secrets: [] };\n\nconst totalIssues = nmapStats.critical_ports + nmapStats.high_ports + sslData.vulnerabilities + jsData.secrets_found;\n\n// ÏÉÅÏÑ∏ Telegram Î©îÏãúÏßÄ\nlet telegramMsg = `üîí *ÌÜµÌï© Î≥¥Ïïà Ïä§Ï∫î ÏôÑÎ£å*\\n`;\ntelegramMsg += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n`;\n\ntelegramMsg += `üìä *Ïä§Ï∫î ÌÜµÍ≥Ñ*\\n`;\ntelegramMsg += `‚Ä¢ ÎåÄÏÉÅ: \\`${$input.first().json.target}\\`\\n`;\ntelegramMsg += `‚Ä¢ Ïä§Ï∫î ID: ${$input.first().json.scan_id}\\n`;\ntelegramMsg += `‚Ä¢ ÏãúÍ∞Ñ: ${new Date().toLocaleString('ko-KR')}\\n\\n`;\n\ntelegramMsg += `üîç *Nmap Í≤∞Í≥º*\\n`;\ntelegramMsg += `‚Ä¢ Ïó¥Î¶∞ Ìè¨Ìä∏: ${nmapStats.open_ports}Í∞ú\\n`;\ntelegramMsg += `üî¥ Critical: ${nmapStats.critical_ports}Í∞ú\\n`;\ntelegramMsg += `üü† High: ${nmapStats.high_ports}Í∞ú\\n`;\ntelegramMsg += `üü° Medium: ${nmapStats.medium_ports}Í∞ú\\n\\n`;\n\ntelegramMsg += `üîê *SSLScan Í≤∞Í≥º*\\n`;\ntelegramMsg += `‚Ä¢ SSL Ï∑®ÏïΩÏ†ê: ${sslData.vulnerabilities}Í∞ú\\n\\n`;\n\ntelegramMsg += `üîë *JS Scanner Í≤∞Í≥º*\\n`;\ntelegramMsg += `‚Ä¢ ÏãúÌÅ¨Î¶ø ÎÖ∏Ï∂ú: ${jsData.secrets_found}Í∞ú\\n\\n`;\n\ntelegramMsg += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\n\nif (totalIssues === 0) {\n  telegramMsg += `‚úÖ *Ïã¨Í∞ÅÌïú Î≥¥Ïïà Ïù¥Ïäà ÏóÜÏùå*`;\n} else {\n  telegramMsg += `‚ö†Ô∏è *Ï¥ù ${totalIssues}Í∞ú Î≥¥Ïïà Ïù¥Ïäà Î∞úÍ≤¨*\\n\\n`;\n  \n  // ÏúÑÌóò Ìè¨Ìä∏ ÏÉÅÏÑ∏\n  if (nmapStats.critical_ports > 0 || nmapStats.high_ports > 0) {\n    telegramMsg += `*ÏúÑÌóò Ìè¨Ìä∏ ÏÉÅÏÑ∏:*\\n`;\n    hosts.forEach(host => {\n      const dangerPorts = host.ports.filter(p => \n        p.state === 'open' && ['critical', 'high'].includes(p.risk_level)\n      );\n      \n      if (dangerPorts.length > 0) {\n        telegramMsg += `\\nüñ• ${host.ip}\\n`;\n        dangerPorts.forEach(port => {\n          const icon = port.risk_level === 'critical' ? 'üî¥' : 'üü†';\n          telegramMsg += `  ${icon} ${port.port}/${port.protocol} - ${port.service}\\n`;\n        });\n      }\n    });\n  }\n}\n\nreturn {\n  json: {\n    scan_id: $input.first().json.scan_id,\n    target: $input.first().json.target,\n    nmap: { stats: nmapStats, hosts },\n    sslscan: sslData,\n    jsscanner: jsData,\n    telegram_message: telegramMsg,\n    alert_required: totalIssues > 0,\n    total_issues: totalIssues\n  }\n};"
      },
      "id": "parse-all",
      "name": "Í≤∞Í≥º ÌÜµÌï© Î∂ÑÏÑù",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2000, 400]
    },
    {
      "parameters": {
        "chatId": "35821428",
        "text": "={{ $json.telegram_message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-send",
      "name": "üì± Telegram Ï†ÑÏÜ°",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [2220, 400],
      "credentials": {
        "telegramApi": {
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "status",
              "name": "status",
              "value": "completed",
              "type": "string"
            },
            {
              "id": "timestamp",
              "name": "completed_at",
              "value": "={{ $now.toISO() }}",
              "type": "string"
            },
            {
              "id": "total_issues",
              "name": "total_issues",
              "value": "={{ $json.total_issues }}",
              "type": "number"
            }
          ]
        }
      },
      "id": "final",
      "name": "‚úÖ ÏôÑÎ£å",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [2440, 400]
    }
  ],
  "connections": {
    "Start": {
      "main": [[{"node": "Ïä§Ï∫î ÎåÄÏÉÅ ÏÑ§Ï†ï", "type": "main", "index": 0}]]
    },
    "Ïä§Ï∫î ÎåÄÏÉÅ ÏÑ§Ï†ï": {
      "main": [[{"node": "1Ô∏è‚É£ Nmap Ïä§Ï∫î", "type": "main", "index": 0}]]
    },
    "1Ô∏è‚É£ Nmap Ïä§Ï∫î": {
      "main": [[{"node": "Nmap Í≤∞Í≥º Ï†ÄÏû•", "type": "main", "index": 0}]]
    },
    "Nmap Í≤∞Í≥º Ï†ÄÏû•": {
      "main": [[{"node": "2Ô∏è‚É£ SSLScan", "type": "main", "index": 0}]]
    },
    "2Ô∏è‚É£ SSLScan": {
      "main": [[{"node": "SSL Í≤∞Í≥º Ï†ÄÏû•", "type": "main", "index": 0}]]
    },
    "SSL Í≤∞Í≥º Ï†ÄÏû•": {
      "main": [[{"node": "3Ô∏è‚É£ JS Scanner", "type": "main", "index": 0}]]
    },
    "3Ô∏è‚É£ JS Scanner": {
      "main": [[{"node": "JS Í≤∞Í≥º Ï†ÄÏû•", "type": "main", "index": 0}]]
    },
    "JS Í≤∞Í≥º Ï†ÄÏû•": {
      "main": [[{"node": "Í≤∞Í≥º ÌÜµÌï© Î∂ÑÏÑù", "type": "main", "index": 0}]]
    },
    "Í≤∞Í≥º ÌÜµÌï© Î∂ÑÏÑù": {
      "main": [[{"node": "üì± Telegram Ï†ÑÏÜ°", "type": "main", "index": 0}]]
    },
    "üì± Telegram Ï†ÑÏÜ°": {
      "main": [[{"node": "‚úÖ ÏôÑÎ£å", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
